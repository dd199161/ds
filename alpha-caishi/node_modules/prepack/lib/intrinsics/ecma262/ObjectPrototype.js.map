{"version":3,"sources":["../../../src/intrinsics/ecma262/ObjectPrototype.js"],"names":["realm","obj","defineNativeMethod","context","V","P","ToPropertyKey","throwIfNotConcrete","O","ToObjectPartial","mightBeObject","intrinsics","false","throwIfNotConcreteObject","$GetPrototypeOf","true","desc","$GetOwnProperty","ThrowIfMightHaveBeenDeleted","value","enumerable","undefined","defineNativeProperty","ObjectProto_toString","$DefineOwnProperty","get","ToObject","set","proto","status","$SetPrototypeOf","createErrorThrowCompletion","TypeError"],"mappings":"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","file":"ObjectPrototype.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport { NativeFunctionValue, ObjectValue, BooleanValue, NullValue } from \"../../values/index.js\";\nimport { SameValuePartial, RequireObjectCoercible } from \"../../methods/abstract.js\";\nimport { HasOwnProperty, HasSomeCompatibleType } from \"../../methods/has.js\";\nimport { Invoke } from \"../../methods/call.js\";\nimport { Properties, To } from \"../../singletons.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function(realm: Realm, obj: ObjectValue): void {\n  // ECMA262 19.1.3.2\n  obj.defineNativeMethod(\"hasOwnProperty\", 1, (context, [V]) => {\n    // 1. Let P be ? ToPropertyKey(V).\n    let P = To.ToPropertyKey(realm, V.throwIfNotConcrete());\n\n    // 2. Let O be ? ToObject(this value).\n    let O = To.ToObjectPartial(realm, context);\n\n    // 3. Return ? HasOwnProperty(O, P).\n    return new BooleanValue(realm, HasOwnProperty(realm, O, P));\n  });\n\n  // ECMA262 19.1.3.3\n  obj.defineNativeMethod(\"isPrototypeOf\", 1, (context, [V]) => {\n    // 1. If Type(V) is not Object, return false.\n    if (!V.mightBeObject()) return realm.intrinsics.false;\n    V = V.throwIfNotConcreteObject();\n\n    // 2. Let O be ? ToObject(this value).\n    let O = To.ToObjectPartial(realm, context);\n\n    // 3. Repeat\n    while (true) {\n      // a. Let V be ? V.[[GetPrototypeOf]]().\n      V = V.$GetPrototypeOf();\n\n      // b. If V is null, return false.\n      if (V instanceof NullValue) return realm.intrinsics.false;\n\n      // c. If SameValue(O, V) is true, return true.\n      if (SameValuePartial(realm, O, V) === true) return realm.intrinsics.true;\n    }\n\n    invariant(false);\n  });\n\n  // ECMA262 19.1.3.4\n  obj.defineNativeMethod(\"propertyIsEnumerable\", 1, (context, [V]) => {\n    // 1. Let P be ? ToPropertyKey(V).\n    let P = To.ToPropertyKey(realm, V.throwIfNotConcrete());\n\n    // 2. Let O be ? ToObject(this value).\n    let O = To.ToObjectPartial(realm, context);\n\n    // 3. Let desc be ? O.[[GetOwnProperty]](P).\n    let desc = O.$GetOwnProperty(P);\n\n    // 4. If desc is undefined, return false.\n    if (!desc) return realm.intrinsics.false;\n    Properties.ThrowIfMightHaveBeenDeleted(desc.value);\n\n    // 5. Return the value of desc.[[Enumerable]].\n    return desc.enumerable === undefined ? realm.intrinsics.undefined : new BooleanValue(realm, desc.enumerable);\n  });\n\n  // ECMA262 19.1.3.5\n  obj.defineNativeMethod(\"toLocaleString\", 0, context => {\n    // 1. Let O be the this value.\n    let O = context;\n\n    // 2. Return ? Invoke(O, \"toString\").\n    return Invoke(realm, O, \"toString\");\n  });\n\n  // ECMA262 19.1.3.6\n  obj.defineNativeProperty(\"toString\", realm.intrinsics.ObjectProto_toString);\n\n  // ECMA262 19.1.3.7\n  obj.defineNativeMethod(\"valueOf\", 0, context => {\n    // 1. Return ? ToObject(this value).\n    return To.ToObjectPartial(realm, context);\n  });\n\n  obj.$DefineOwnProperty(\"__proto__\", {\n    // B.2.2.1.1\n    get: new NativeFunctionValue(realm, undefined, \"get __proto__\", 0, context => {\n      // 1. Let O be ? ToObject(this value).\n      let O = To.ToObject(realm, context.throwIfNotConcrete());\n\n      // 2. Return ? O.[[GetPrototypeOf]]().\n      return O.$GetPrototypeOf();\n    }),\n\n    // B.2.2.1.2\n    set: new NativeFunctionValue(realm, undefined, \"set __proto__\", 1, (context, [proto]) => {\n      // 1. Let O be ? RequireObjectCoercible(this value).\n      let O = RequireObjectCoercible(realm, context);\n\n      // 2. If Type(proto) is neither Object nor Null, return undefined.\n      if (!HasSomeCompatibleType(proto, ObjectValue, NullValue)) return realm.intrinsics.undefined;\n\n      // 3. If Type(O) is not Object, return undefined.\n      if (!O.mightBeObject()) return realm.intrinsics.undefined;\n      O = O.throwIfNotConcreteObject();\n\n      // 4. Let status be ? O.[[SetPrototypeOf]](proto).\n      let status = O.$SetPrototypeOf(((proto.throwIfNotConcrete(): any): ObjectValue | NullValue));\n\n      // 5. If status is false, throw a TypeError exception.\n      if (!status) {\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"couldn't set proto\");\n      }\n\n      // 6. Return undefined.\n      return realm.intrinsics.undefined;\n    }),\n  });\n}\n"]}