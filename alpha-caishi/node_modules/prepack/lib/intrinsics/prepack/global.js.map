{"version":3,"sources":["../../../src/intrinsics/prepack/global.js"],"names":["createAbstractFunction","realm","global","$GlobalObject","$DefineOwnProperty","value","context","args","console","log","map","arg","serialize","writable","enumerable","configurable","intrinsics","null","undefined","ObjectPrototype","additonalFunctionUid","functionValue","assignToGlobal","t","memberExpression","identifier","react","enabled","reactComponentRootUid","deriveNativeFunctionValue","unsafe","typeNameOrTemplate","f","useAbstractInterpretation","createErrorThrowCompletion","TypeError","type","template","isTypeCompatibleWith","constructor","isResidual","isUnsafeResidual","result","createTemporalFromBuildFunction","concat","callExpression","nodes","slice","makePartial","values","Set","generator","rebuildNestedProperties","getIdentifier","name","object","makeSimple","propertyName","invariantOptions","key","ToStringPartial","propertyIdentifier","getAsPropertyNameExpression","computed","isIdentifier","condition","objectNode","valueNode","binaryExpression","invariantOptionString","valueToNode","emitInvariant","objnode","$Set","intrinsicName","rebuildObjectProperty","$Realm","__IntrospectionError","additionalValues"],"mappings":"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","file":"global.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport {\n  AbstractObjectValue,\n  AbstractValue,\n  BooleanValue,\n  ConcreteValue,\n  ECMAScriptSourceFunctionValue,\n  FunctionValue,\n  NativeFunctionValue,\n  ObjectValue,\n  StringValue,\n  Value,\n} from \"../../values/index.js\";\nimport { To } from \"../../singletons.js\";\nimport { ValuesDomain } from \"../../domains/index.js\";\nimport * as t from \"babel-types\";\nimport type { BabelNodeExpression, BabelNodeSpreadElement } from \"babel-types\";\nimport invariant from \"../../invariant.js\";\nimport { createAbstract, parseTypeNameOrTemplate } from \"./utils.js\";\n\nexport function createAbstractFunction(realm: Realm, ...additionalValues: Array<ConcreteValue>): NativeFunctionValue {\n  return new NativeFunctionValue(realm, \"global.__abstract\", \"__abstract\", 0, (context, [typeNameOrTemplate, name]) => {\n    if (name instanceof StringValue) name = name.value;\n    if (name !== undefined && typeof name !== \"string\") {\n      throw new TypeError(\"intrinsic name argument is not a string\");\n    }\n    return createAbstract(realm, typeNameOrTemplate, name, ...additionalValues);\n  });\n}\n\nexport default function(realm: Realm): void {\n  let global = realm.$GlobalObject;\n\n  global.$DefineOwnProperty(\"dump\", {\n    value: new NativeFunctionValue(realm, \"global.dump\", \"dump\", 0, (context, args) => {\n      console.log(\"dump\", args.map(arg => arg.serialize()));\n      return context;\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function to model values that are obtained from the environment,\n  // and whose concrete values are not known at Prepack-time.\n  // __abstract(typeNameOrTemplate, name, options) creates a new abstract value\n  // where typeNameOrTemplate either either 'string', 'boolean', 'number', 'object', or an actual object defining known properties.\n  // If the abstract value gets somehow embedded in the final heap,\n  // it will be referred to by the supplied name in the generated code.\n  global.$DefineOwnProperty(\"__abstract\", {\n    value: createAbstractFunction(realm),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrNull\", {\n    value: createAbstractFunction(realm, realm.intrinsics.null),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrNullOrUndefined\", {\n    value: createAbstractFunction(realm, realm.intrinsics.null, realm.intrinsics.undefined),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrUndefined\", {\n    value: createAbstractFunction(realm, realm.intrinsics.undefined),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__additionalFunctions\", {\n    value: new ObjectValue(realm, realm.intrinsics.ObjectPrototype, \"__additionalFunctions\", true),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  let additonalFunctionUid = 0;\n  // Allows dynamically registering additional functions.\n  // WARNING: these functions will get exposed at global scope and called there.\n  // NB: If we interpret one of these calls in an evaluateForEffects context\n  //     that is not subsequently applied, the function will not be registered\n  //     (because prepack won't have a correct value for the FunctionValue itself)\n  global.$DefineOwnProperty(\"__registerAdditionalFunctionToPrepack\", {\n    value: new NativeFunctionValue(\n      realm,\n      \"global.__registerAdditionalFunctionToPrepack\",\n      \"__registerAdditionalFunctionToPrepack\",\n      0,\n      (context, [functionValue]) => {\n        invariant(functionValue instanceof ECMAScriptSourceFunctionValue);\n        realm.assignToGlobal(\n          t.memberExpression(\n            t.memberExpression(t.identifier(\"global\"), t.identifier(\"__additionalFunctions\")),\n            t.identifier(\"\" + additonalFunctionUid++)\n          ),\n          functionValue\n        );\n        return realm.intrinsics.undefined;\n      }\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  if (realm.react.enabled) {\n    global.$DefineOwnProperty(\"__reactComponentRoots\", {\n      value: new ObjectValue(realm, realm.intrinsics.ObjectPrototype, \"__reactComponentRoots\", true),\n      writable: true,\n      enumerable: false,\n      configurable: true,\n    });\n    let reactComponentRootUid = 0;\n    // this is almost a copy of the additionalFunctions code above\n    global.$DefineOwnProperty(\"__registerReactComponentRoot\", {\n      value: new NativeFunctionValue(\n        realm,\n        \"global.__registerReactComponentRoot\",\n        \"__registerReactComponentRoot\",\n        0,\n        (context, [functionValue]) => {\n          invariant(functionValue instanceof ECMAScriptSourceFunctionValue);\n          realm.assignToGlobal(\n            t.memberExpression(\n              t.memberExpression(t.identifier(\"global\"), t.identifier(\"__reactComponentRoots\")),\n              t.identifier(\"\" + reactComponentRootUid++)\n            ),\n            functionValue\n          );\n          return realm.intrinsics.undefined;\n        }\n      ),\n      writable: true,\n      enumerable: false,\n      configurable: true,\n    });\n  }\n\n  // Maps from initialized moduleId to exports object\n  // NB: Changes to this shouldn't ever be serialized\n  global.$DefineOwnProperty(\"__initializedModules\", {\n    value: new ObjectValue(realm, realm.intrinsics.ObjectPrototype, \"__initializedModules\", true),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function used to instatiate a residual function\n  function deriveNativeFunctionValue(unsafe: boolean): NativeFunctionValue {\n    return new NativeFunctionValue(\n      realm,\n      \"global.__residual\",\n      \"__residual\",\n      2,\n      (context, [typeNameOrTemplate, f, ...args]) => {\n        if (!realm.useAbstractInterpretation) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"realm is not partial\");\n        }\n\n        let { type, template } = parseTypeNameOrTemplate(realm, typeNameOrTemplate);\n\n        if (!Value.isTypeCompatibleWith(f.constructor, FunctionValue)) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"cannot determine residual function\");\n        }\n        invariant(f instanceof FunctionValue);\n        f.isResidual = true;\n        if (unsafe) f.isUnsafeResidual = true;\n        let result = AbstractValue.createTemporalFromBuildFunction(realm, type, [f].concat(args), nodes =>\n          t.callExpression(nodes[0], ((nodes.slice(1): any): Array<BabelNodeExpression | BabelNodeSpreadElement>))\n        );\n        if (template) {\n          invariant(\n            result instanceof AbstractValue,\n            \"the nested properties should only be rebuilt for an abstract value\"\n          );\n          template.makePartial();\n          result.values = new ValuesDomain(new Set([template]));\n          invariant(realm.generator);\n          realm.rebuildNestedProperties(result, result.getIdentifier().name);\n        }\n        return result;\n      }\n    );\n  }\n\n  // Helper function that identifies a computation that must remain part of the residual program and cannot be partially evaluated,\n  // e.g. because it contains a loop over abstract values.\n  // __residual(typeNameOrTemplate, function, arg0, arg1, ...) creates a new abstract value\n  // that is computed by invoking function(arg0, arg1, ...) in the residual program and\n  // where typeNameOrTemplate either either 'string', 'boolean', 'number', 'object', or an actual object defining known properties.\n  // The function must not have side effects, and it must not access any state (besides the supplied arguments).\n  global.$DefineOwnProperty(\"__residual\", {\n    value: deriveNativeFunctionValue(false),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function that identifies a variant of the residual function that has implicit dependencies. This version of residual will infer the dependencies\n  // and rewrite the function body to do the same thing as the original residual function.\n  global.$DefineOwnProperty(\"__residual_unsafe\", {\n    value: deriveNativeFunctionValue(true),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // TODO #1023: Remove this property. It's just here as some existing internal test cases assume that the __annotate property is exists and is readable.\n  global.$DefineOwnProperty(\"__annotate\", {\n    value: realm.intrinsics.undefined,\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Internal helper function for tests.\n  // __isAbstract(value) checks if a given value is abstract.\n  global.$DefineOwnProperty(\"__isAbstract\", {\n    value: new NativeFunctionValue(realm, \"global.__isAbstract\", \"__isAbstract\", 1, (context, [value]) => {\n      return new BooleanValue(realm, value instanceof AbstractValue);\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // __makePartial(object) marks an (abstract) object as partial.\n  global.$DefineOwnProperty(\"__makePartial\", {\n    value: new NativeFunctionValue(realm, \"global.__makePartial\", \"__makePartial\", 1, (context, [object]) => {\n      // casting to any to avoid Flow bug\n      if ((object: any) instanceof AbstractObjectValue || (object: any) instanceof ObjectValue) {\n        (object: any).makePartial();\n        return object;\n      }\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // __makeSimple(object) marks an (abstract) object as one that has no getters or setters.\n  global.$DefineOwnProperty(\"__makeSimple\", {\n    value: new NativeFunctionValue(realm, \"global.__makeSimple\", \"__makeSimple\", 1, (context, [object]) => {\n      // casting to any to avoid Flow bug\n      if ((object: any) instanceof AbstractObjectValue || (object: any) instanceof ObjectValue) {\n        (object: any).makeSimple();\n        return object;\n      }\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function that emits a check whether a given object property has a particular value.\n  global.$DefineOwnProperty(\"__assumeDataProperty\", {\n    value: new NativeFunctionValue(\n      realm,\n      \"global.__assumeDataProperty\",\n      \"__assumeDataProperty\",\n      3,\n      (context, [object, propertyName, value, invariantOptions]) => {\n        if (!realm.useAbstractInterpretation) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"realm is not partial\");\n        }\n\n        // casting to any to avoid Flow bug \"*** Recursion limit exceeded ***\"\n        if ((object: any) instanceof AbstractObjectValue || (object: any) instanceof ObjectValue) {\n          let generator = realm.generator;\n          invariant(generator);\n\n          let key = To.ToStringPartial(realm, propertyName);\n          let propertyIdentifier = generator.getAsPropertyNameExpression(key);\n          let computed = !t.isIdentifier(propertyIdentifier);\n          let condition = ([objectNode, valueNode]) =>\n            t.binaryExpression(\"!==\", t.memberExpression(objectNode, propertyIdentifier, computed), valueNode);\n          if (invariantOptions) {\n            let invariantOptionString = To.ToStringPartial(realm, invariantOptions);\n            switch (invariantOptionString) {\n              case \"VALUE_DEFINED_INVARIANT\":\n                condition = ([objectNode, valueNode]) =>\n                  t.binaryExpression(\n                    \"===\",\n                    t.memberExpression(objectNode, propertyIdentifier, computed),\n                    t.valueToNode(undefined)\n                  );\n                break;\n              case \"SKIP_INVARIANT\":\n                condition = null;\n                break;\n              case \"FULL_INVARIANT\":\n                break;\n              default:\n                invariant(false, \"Invalid invariantOption \" + invariantOptionString);\n            }\n          }\n          if (condition)\n            generator.emitInvariant([object, value, object], condition, objnode =>\n              t.memberExpression(objnode, propertyIdentifier, computed)\n            );\n          realm.generator = undefined; // don't emit code during the following $Set call\n          // casting to due to Flow workaround above\n          (object: any).$Set(key, value, object);\n          realm.generator = generator;\n          if (object.intrinsicName) realm.rebuildObjectProperty(object, key, value, object.intrinsicName);\n          return context.$Realm.intrinsics.undefined;\n        }\n\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n      }\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__IntrospectionError\", {\n    value: realm.intrinsics.__IntrospectionError,\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n}\n"]}