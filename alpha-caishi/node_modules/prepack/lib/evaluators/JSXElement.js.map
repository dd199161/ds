{"version":3,"sources":["../../src/evaluators/JSXElement.js"],"names":["ast","strictCode","env","realm","react","enabled","openingElement","type","evaluateJSXIdentifier","name","evaluateJSXAttributes","attributes","children","key","get","intrinsics","null","ref","undefined","emptyString","props","createReactProps","createReactElement","t","RESERVED_PROPS","__self","__source","cleanJSXElementLiteralChild","child","lines","split","lastNonEmptyLine","i","length","match","str","line","isFirstLine","isLastLine","isLastNonEmptyLine","trimmedLine","replace","evaluateJSXMemberExpression","GetValue","ResolveBinding","evaluate","isTagName","evaluateJSXValue","value","expression","test","getDefaultProps","elementType","defaultProps","memberExpression","identifier","evaluateJSXChildren","singleChild","text","array","ArrayCreate","dynamicChildrenLength","dynamicIterator","lastChildValue","CreateDataPropertyOrThrow","Set","astAttributes","astChildren","Map","properties","defaultPropValue","set","astAttribute","spreadValue","argument","spreadProp","descriptor","spreadPropValue","obj","ObjectCreate","ObjectPrototype","hasOwnProperty"],"mappings":"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","file":"JSXElement.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../realm.js\";\nimport type { LexicalEnvironment } from \"../environment.js\";\nimport { FatalError } from \"../errors.js\";\nimport type {\n  BabelNode,\n  BabelNodeStringLiteral,\n  BabelNodeJSXText,\n  BabelNodeJSXElement,\n  BabelNodeJSXIdentifier,\n  BabelNodeJSXMemberExpression,\n  BabelNodeJSXAttribute,\n  BabelNodeJSXSpreadAttribute,\n  BabelNodeJSXExpressionContainer,\n} from \"babel-types\";\nimport { ArrayValue, StringValue, Value, NumberValue, ObjectValue } from \"../values/index.js\";\nimport { getReactSymbol } from \"../react/utils.js\";\nimport { convertJSXExpressionToIdentifier } from \"../react/jsx.js\";\nimport * as t from \"babel-types\";\nimport { Get } from \"../methods/index.js\";\nimport { Create, Environment, Properties } from \"../singletons.js\";\nimport invariant from \"../invariant.js\";\nimport { computeBinary } from \"./BinaryExpression.js\";\n\nlet RESERVED_PROPS = {\n  key: true,\n  ref: true,\n  __self: true,\n  __source: true,\n};\n\n// taken from Babel\nfunction cleanJSXElementLiteralChild(child: string): null | string {\n  let lines = child.split(/\\r\\n|\\n|\\r/);\n\n  let lastNonEmptyLine = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].match(/[^ \\t]/)) {\n      lastNonEmptyLine = i;\n    }\n  }\n\n  let str = \"\";\n\n  for (let i = 0; i < lines.length; i++) {\n    let line = lines[i];\n\n    let isFirstLine = i === 0;\n    let isLastLine = i === lines.length - 1;\n    let isLastNonEmptyLine = i === lastNonEmptyLine;\n\n    // replace rendered whitespace tabs with spaces\n    let trimmedLine = line.replace(/\\t/g, \" \");\n\n    // trim whitespace touching a newline\n    if (!isFirstLine) {\n      trimmedLine = trimmedLine.replace(/^[ ]+/, \"\");\n    }\n\n    // trim whitespace touching an endline\n    if (!isLastLine) {\n      trimmedLine = trimmedLine.replace(/[ ]+$/, \"\");\n    }\n\n    if (trimmedLine) {\n      if (!isLastNonEmptyLine) {\n        trimmedLine += \" \";\n      }\n\n      str += trimmedLine;\n    }\n  }\n\n  if (str) {\n    return str;\n  }\n  return null;\n}\n\nfunction evaluateJSXMemberExpression(\n  ast: BabelNode,\n  strictCode: boolean,\n  env: LexicalEnvironment,\n  realm: Realm\n): Value {\n  switch (ast.type) {\n    case \"JSXIdentifier\":\n      return Environment.GetValue(\n        realm,\n        Environment.ResolveBinding(realm, ((ast: any): BabelNodeJSXIdentifier).name, strictCode, env)\n      );\n    case \"JSXMemberExpression\":\n      return Environment.GetValue(\n        realm,\n        env.evaluate(convertJSXExpressionToIdentifier(((ast: any): BabelNodeJSXMemberExpression)), strictCode)\n      );\n    default:\n      invariant(false, \"Unknown JSX Identifier\");\n  }\n}\n\nfunction evaluateJSXIdentifier(ast, strictCode, env, realm): Value {\n  if (isTagName(ast)) {\n    // special cased lower-case and custom elements\n    return new StringValue(realm, ((ast: any): BabelNodeJSXIdentifier).name);\n  }\n  return evaluateJSXMemberExpression(ast, strictCode, env, realm);\n}\n\nfunction evaluateJSXValue(value: BabelNode, strictCode: boolean, env: LexicalEnvironment, realm: Realm): Value {\n  if (value != null) {\n    switch (value.type) {\n      case \"JSXText\":\n        return new StringValue(realm, ((value: any): BabelNodeJSXText).value);\n      case \"StringLiteral\":\n        return new StringValue(realm, ((value: any): BabelNodeStringLiteral).value);\n      case \"JSXExpressionContainer\":\n        return Environment.GetValue(\n          realm,\n          env.evaluate(((value: any): BabelNodeJSXExpressionContainer).expression, strictCode)\n        );\n      case \"JSXElement\":\n        return Environment.GetValue(realm, env.evaluate(value, strictCode));\n      default:\n        invariant(false, `Unknown JSX value type: ${value.type}`);\n    }\n  }\n  invariant(false, `Null or undefined value passed when trying to evaluate JSX node value`);\n}\n\nfunction isTagName(ast: BabelNode): boolean {\n  return ast.type === \"JSXIdentifier\" && /^[a-z]|\\-/.test(((ast: any): BabelNodeJSXIdentifier).name);\n}\n\nfunction getDefaultProps(\n  elementType: BabelNodeJSXIdentifier | BabelNodeJSXMemberExpression,\n  env,\n  realm: Realm\n): null | ObjectValue {\n  let name;\n  if (elementType.type === \"JSXIdentifier\") {\n    name = elementType.name;\n  }\n  if (!isTagName(elementType) && typeof name === \"string\") {\n    // find the value of \"ComponentXXX.defaultProps\"\n    let defaultProps = Environment.GetValue(\n      realm,\n      env.evaluate(t.memberExpression(t.identifier(name), t.identifier(\"defaultProps\")), false)\n    );\n\n    if (defaultProps instanceof ObjectValue) {\n      return defaultProps;\n    }\n  }\n  return null;\n}\n\nfunction evaluateJSXChildren(\n  children: Array<BabelNode>,\n  strictCode: boolean,\n  env: LexicalEnvironment,\n  realm: Realm\n): ArrayValue | Value | null {\n  if (children.length === 0) {\n    return null;\n  }\n  if (children.length === 1) {\n    let singleChild = evaluateJSXValue(children[0], strictCode, env, realm);\n\n    if (singleChild instanceof StringValue) {\n      let text = cleanJSXElementLiteralChild(singleChild.value);\n      if (text !== null) {\n        singleChild.value = text;\n      }\n    }\n    return singleChild;\n  }\n  let array = Create.ArrayCreate(realm, 0);\n  let dynamicChildrenLength = children.length;\n  let dynamicIterator = 0;\n  let lastChildValue = null;\n  for (let i = 0; i < children.length; i++) {\n    let value = evaluateJSXValue(children[i], strictCode, env, realm);\n    if (value instanceof StringValue) {\n      let text = cleanJSXElementLiteralChild(value.value);\n      if (text === null) {\n        dynamicChildrenLength--;\n        // this is a space full of whitespace, so let's proceed\n        continue;\n      } else {\n        value.value = text;\n      }\n    }\n    lastChildValue = value;\n    Create.CreateDataPropertyOrThrow(realm, array, \"\" + dynamicIterator, value);\n    dynamicIterator++;\n  }\n  if (dynamicChildrenLength === 1) {\n    return lastChildValue;\n  }\n\n  Properties.Set(realm, array, \"length\", new NumberValue(realm, dynamicChildrenLength), false);\n  return array;\n}\n\nfunction evaluateJSXAttributes(\n  elementType: BabelNodeJSXIdentifier | BabelNodeJSXMemberExpression,\n  astAttributes: Array<BabelNodeJSXAttribute | BabelNodeJSXSpreadAttribute>,\n  astChildren: Array<BabelNode>,\n  strictCode: boolean,\n  env: LexicalEnvironment,\n  realm: Realm\n): { attributes: Map<string, Value>, children: ArrayValue | Value | null } {\n  let attributes = new Map();\n  let children = evaluateJSXChildren(astChildren, strictCode, env, realm);\n  let defaultProps = getDefaultProps(elementType, env, realm);\n\n  // defaultProps are a bit like default function arguments\n  // if an actual value exists, it should overwrite the default value\n  if (defaultProps !== null) {\n    for (let [key] of defaultProps.properties) {\n      let defaultPropValue = Get(realm, defaultProps, key);\n\n      if (defaultPropValue instanceof Value) {\n        if (key === \"children\") {\n          if (children === null) {\n            children = defaultPropValue;\n          }\n        } else {\n          attributes.set(key, defaultPropValue);\n        }\n      }\n    }\n  }\n  for (let astAttribute of astAttributes) {\n    switch (astAttribute.type) {\n      case \"JSXAttribute\":\n        let { name, value } = astAttribute;\n\n        invariant(name.type === \"JSXIdentifier\", `JSX attribute name type not supported: ${astAttribute.type}`);\n        attributes.set(name.name, evaluateJSXValue(((value: any): BabelNodeJSXIdentifier), strictCode, env, realm));\n        break;\n      case \"JSXSpreadAttribute\":\n        let spreadValue = Environment.GetValue(realm, env.evaluate(astAttribute.argument, strictCode));\n\n        if (spreadValue instanceof ObjectValue) {\n          for (let [key, spreadProp] of spreadValue.properties) {\n            if (spreadProp !== undefined && spreadProp.descriptor !== undefined) {\n              let spreadPropValue = spreadProp.descriptor.value;\n\n              if (spreadPropValue instanceof Value) {\n                if (key === \"children\") {\n                  children = spreadPropValue;\n                } else {\n                  attributes.set(key, spreadPropValue);\n                }\n              }\n            }\n          }\n        } else {\n          throw new FatalError(\"ObjectValues are the only supported value for JSX Spread Attributes\");\n        }\n        break;\n      default:\n        invariant(false, `Unknown JSX attribute type:: ${astAttribute.type}`);\n    }\n  }\n  return {\n    attributes,\n    children,\n  };\n}\n\nfunction createReactProps(\n  realm: Realm,\n  type: Value,\n  attributes: Map<string, Value>,\n  children,\n  env: LexicalEnvironment\n): ObjectValue {\n  let obj = Create.ObjectCreate(realm, realm.intrinsics.ObjectPrototype);\n  for (let [key, value] of attributes) {\n    if (typeof key === \"string\") {\n      if (RESERVED_PROPS.hasOwnProperty(key)) {\n        continue;\n      }\n      Create.CreateDataPropertyOrThrow(realm, obj, key, value);\n    }\n  }\n  if (children !== null) {\n    Create.CreateDataPropertyOrThrow(realm, obj, \"children\", children);\n  }\n  return obj;\n}\n\nfunction createReactElement(realm: Realm, type: Value, key: Value, ref: Value, props: ObjectValue): ObjectValue {\n  let obj = Create.ObjectCreate(realm, realm.intrinsics.ObjectPrototype);\n  Create.CreateDataPropertyOrThrow(realm, obj, \"$$typeof\", getReactSymbol(\"react.element\", realm));\n  Create.CreateDataPropertyOrThrow(realm, obj, \"type\", type);\n  Create.CreateDataPropertyOrThrow(realm, obj, \"key\", key);\n  Create.CreateDataPropertyOrThrow(realm, obj, \"ref\", ref);\n  Create.CreateDataPropertyOrThrow(realm, obj, \"props\", props);\n  Create.CreateDataPropertyOrThrow(realm, obj, \"_owner\", realm.intrinsics.null);\n  return obj;\n}\n\nexport default function(\n  ast: BabelNodeJSXElement,\n  strictCode: boolean,\n  env: LexicalEnvironment,\n  realm: Realm\n): ObjectValue {\n  invariant(realm.react.enabled, \"JSXElements can only be evaluated with the reactEnabled option\");\n  let openingElement = ast.openingElement;\n  let type = evaluateJSXIdentifier(openingElement.name, strictCode, env, realm);\n  let { attributes, children } = evaluateJSXAttributes(\n    openingElement.name,\n    openingElement.attributes,\n    ast.children,\n    strictCode,\n    env,\n    realm\n  );\n  let key = attributes.get(\"key\") || realm.intrinsics.null;\n  let ref = attributes.get(\"ref\") || realm.intrinsics.null;\n\n  if (key === realm.intrinsics.undefined) {\n    key = realm.intrinsics.null;\n  }\n  if (ref === realm.intrinsics.undefined) {\n    ref = realm.intrinsics.null;\n  }\n\n  // React uses keys to identify nodes as they get updated through the reconcilation\n  // phase. Keys are used in a map and thus need to be converted to strings\n  if (key !== realm.intrinsics.null) {\n    key = computeBinary(realm, \"+\", realm.intrinsics.emptyString, key);\n  }\n  let props = createReactProps(realm, type, attributes, children, env);\n\n  return createReactElement(realm, type, key, ref, props);\n}\n"]}